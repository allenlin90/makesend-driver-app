!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loginProcess=t.checkToken=t.generateHeaders=void 0;var r,a,o,i=t.generateHeaders=(r=l(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(d,{method:"post",mod:"cors",headers:{"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){return e}));case 3:return t=e.sent,e.abrupt("return",t);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,this,[[0,7]])}))),function(){return r.apply(this,arguments)});t.checkToken=(a=l(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=!1,n=f(),e.next=4,i();case 4:if(r=e.sent,!n){e.next=10;break}return e.next=8,fetch(v,{method:"post",mod:"cors",responseType:"json",headers:{"Content-Type":"application/json","User-Token":""+n,"Client-Token":r["Client-Token"],"Time-Stamp":r["Time-Stamp"],"Time-Signature":r["Time-Signature"]}}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){return console.log(e)}));case 8:200===e.sent.resCode&&(t=!0);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)}),t.loginProcess=(o=l(regeneratorRuntime.mark((function e(){var t,n,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i();case 2:return t=e.sent,e.next=5,fetch(p,{method:"post",headers:{"Content-type":"application/json","Client-Token":t["Client-Token"],"Time-Stamp":t["Time-Stamp"],"Time-Signature":t["Time-Signature"]},body:JSON.stringify({email:r,password:a,keepAlive:o?1:0})}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){return e}));case 5:if(200!==(n=e.sent).resCode){e.next=10;break}return o?localStorage.setItem("token",n.token):sessionStorage.setItem("token",n.token),window.location.hash="dashboard",e.abrupt("return",!0);case 10:return e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)});t.userToken=f;var s,c=n(1),u=(s=c)&&s.__esModule?s:{default:s};function l(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,o){try{var i=t[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}var d=u.default.host+"/header",p=u.default.host+"/login",v=u.default.checkToken;function f(){return sessionStorage.getItem("token")||localStorage.getItem("token")||null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="https://makesend-driver.herokuapp.com",a="https://api.airportels.asia",o={host:r,checkToken:a+"/api/msd/authPing",uploadEndpoint:a+"/api/msd/delivery/uploadPOD",searchParcelByPhone:r+"/parcel",searchParcelById:a+"/api/waybill/detail"};t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.userLogin=function(){sessionStorage.clear(),localStorage.clear(),window.location.hash="",a.innerHTML='\n        <div id="login_form">\n            <div id="makesend_logo">\n                <img src="https://www.makesend.asia/wp-content/uploads/2018/06/logo-makesend.png" alt="ms_logo">\n            </div>\n            <form action="" autocomplete="off">\n                <div class="mb-3">\n                    <label for="email" class="form-label">Email</label>\n                    <input type="text" class="form-control" id="email" aria-describedby="emailHelp"\n                        autocomplete="off">\n                    <div class="invalid-feedback">Your email is not correct</div>\n                </div>\n                <div class="mb-3">\n                    <label for="password" class="form-label">Password</label>\n                    <input type="password" class="form-control" id="password">\n                    <div class="invalid-feedback">Your password is not correct</div>\n                </div>\n                <div class="mb-3 form-check">\n                    <input type="checkbox" class="form-check-input" id="remember_me" checked>\n                    <label class="form-check-label" for="remember_me">Remember me</label>\n                </div>\n                <button type="submit" class="btn btn-warning">Login</button>\n                <div>\n                    <a href="#resetpassword">Forget Password?</a>\n                </div>\n            </form>\n        </div>\n    ';var e=document.querySelector("#login_form"),t=document.querySelector("#email"),n=document.querySelector("#password"),o=document.querySelector("#remember_me");function i(){n.classList.remove("is-invalid"),t.classList.remove("is-invalid")}t.addEventListener("input",i),n.addEventListener("input",i),e.addEventListener("submit",(s=regeneratorRuntime.mark((function e(a){var i,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),i=t.value,s=n.value,i&&s){e.next=9;break}t.classList.add("is-invalid"),n.classList.add("is-invalid"),e.next=17;break;case 9:if(!i||!s){e.next=15;break}return e.next=12,(0,r.loginProcess)(i,s,o.checked);case 12:if(!e.sent){e.next=15;break}return e.abrupt("return");case 15:t.classList.add("is-invalid"),n.classList.add("is-invalid");case 17:case"end":return e.stop()}}),e,this)})),c=function(){var e=s.apply(this,arguments);return new Promise((function(t,n){return function r(a,o){try{var i=e[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(s)}("next")}))},function(e){return c.apply(this,arguments)}));var s,c};var r=n(0);var a=document.querySelector(".container")},function(e,t,n){"use strict";var r=n(2),a=n(4),o=n(0),i=n(5),s=n(9);function c(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,o){try{var i=t[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}window.onload=c(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t=localStorage.getItem("token")||sessionStorage.getItem("token"))){e.next=8;break}return e.next=4,(0,o.checkToken)(t);case 4:e.sent?(window.location.hash="dashboard",(0,a.navigators)(),(0,i.searchFeatures)()):(0,r.userLogin)(),e.next=9;break;case 8:(0,r.userLogin)();case 9:window.onhashchange=c(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("path changes!"),e.next=3,(0,o.checkToken)();case 3:if(t=e.sent,(0,s.stopStream)(),!t){e.next=26;break}e.t0=window.location.hash,e.next="#dashboard"===e.t0?9:"#scanner"===e.t0?12:"#search"===e.t0?15:"#tasks"===e.t0?18:"#setting"===e.t0?20:"#resetpassword"===e.t0?22:23;break;case 9:return(0,a.navigators)(),(0,i.searchFeatures)(),e.abrupt("break",24);case 12:return(0,a.navigators)("scanner"),(0,s.qrScanner)(),e.abrupt("break",24);case 15:return(0,a.navigators)("search"),(0,i.searchFeatures)(),e.abrupt("break",24);case 18:return(0,a.navigators)("tasks"),e.abrupt("break",24);case 20:return(0,a.navigators)("setting"),e.abrupt("break",24);case 22:return e.abrupt("break",24);case 23:window.location.hash="";case 24:e.next=27;break;case 26:(0,r.userLogin)();case 27:case"end":return e.stop()}}),e,this)})));case 10:case"end":return e.stop()}}),e,this)})))},function(e,t,n){"use strict";function r(e){var t=document.querySelector("#navi_scanner"),n=document.querySelector("#navi_search"),r=document.querySelector("#navi_tasks"),a=document.querySelector("#navi_setting");switch([r,n,t,a].forEach((function(e){e.classList.remove("selected")})),e){case"dashboard":n.classList.add("selected");break;case"scanner":t.classList.add("selected");break;case"tasks":r.classList.add("selected");break;case"setting":a.classList.add("selected");break;default:n.classList.add("selected")}}function a(){var e=document.querySelector("#navi_logout"),t=document.querySelector("body"),n=document.querySelector("footer");e.addEventListener("click",(function(e){e.stopPropagation(),sessionStorage.clear(),localStorage.clear(),n.innerHTML="",t.style.backgroundColor="rgba(0, 0, 0, 0.1)",document.querySelector(".container").style.justifyContent="center",window.location.hash=""}))}Object.defineProperty(t,"__esModule",{value:!0}),t.navigators=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"dashboard",t=document.querySelector(".container"),n=document.querySelector("footer");t.innerHTML="",n.innerHTML='\n        <div class="navigator">\n            <div>\n                <a href="#scanner" class="" id="navi_scanner">\n                    <i class="fas fa-qrcode"></i>\n                    <span>Scan</span>\n                </a>\n            </div>\n            <div>\n                <a href="#search" class="" id="navi_search">\n                    <i class="fas fa-search"></i>\n                    <span>Search</span>\n                </a>\n            </div>\n            <div>\n                <a href="#tasks" class="" id="navi_tasks">\n                    <i class="fas fa-tasks"></i>\n                    <span>Tasks</span>\n                </a>\n            </div>\n            <div>\n                <a href="#setting" class="" id="navi_setting">\n                    <i class="fas fa-cog"></i>\n                    <span>Setting</span>\n                </a>\n            </div>\n            <div>\n                <a href="#" class="" id="navi_logout">\n                    <i class="fas fa-sign-out-alt"></i>\n                    <span>Logout</span>\n                </a>\n            </div>\n        </div>\n    ',a(),r(e)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.searchFeatures=function(){var e=document.querySelector(".container");e.style.justifyContent="space-between",e.innerHTML='\n    <div id="search_parcel">\n        <div id="search_functions">\n            <div id="search_by_phone_btn" class="btn btn-warning">Receiver Phone</div>\n            <div id="search_by_tracking_id_btn" class="btn btn-dark">Tracking ID</div>\n        </div>\n        <div id="search_list">\n            <div id="search_bar">\n                <form action="">\n                    <input class="form-control" id="receiver_phone" type="tel" name="receiver_phone" value=""\n                        inputmode="numeric" placeholder="E.g. 0632166699" autocomplete="off" pattern="[0-9]{10}">\n                    <button type="submit"><i class="fa fa-search"></i></button>\n                </form>\n            </div>            \n            <div id="result_list">\n                <ul class="list-group list-group-flush">\n                    <li class="list-group-item">Please search parcel by <br> <b>Receiver Phone</b> or <br> <b>Tracking ID</b></li>\n                </ul>\n            </div>\n        </div>\n    </div>\n    ',(0,r.handleSubmitEvent)(),(0,r.handleInputEvent)();var t=document.querySelector("#search_by_phone_btn"),n=document.querySelector("#search_by_tracking_id_btn"),a=document.querySelector("#search_bar");function o(e){var t=this;e.stopPropagation(),[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(this.parentNode.children)).forEach((function(e){e===t?(e.classList.add("btn-warning"),e.classList.remove("btn-dark")):(e.classList.add("btn-dark"),e.classList.remove("btn-warning"))})),"search_by_tracking_id_btn"===this.id?a.innerHTML='\n    <form action="" class="form-group">\n        <input class="form-control" id="tracking_id" type="text" name="tracking_id" value=""\n            placeholder="#EX1234567890123" autocomplete="off">\n        <button type="submit"><i class="fa fa-search"></i></button>        \n    </form>\n    ':"search_by_phone_btn"===this.id&&(a.innerHTML='\n    <form action="">\n        <input class="form-control" id="receiver_phone" type="tel" name="receiver_phone" value=""\n            inputmode="numeric" placeholder="E.g. 0632166699" autocomplete="off" pattern="[0-9]{10}">\n        <button type="submit"><i class="fa fa-search"></i></button>\n    </form>\n    '),document.querySelector("#result_list ul").innerHTML='<li class="list-group-item">Please search parcel by <br> <b>Receiver Phone</b> or <br> <b>Tracking ID</b></li>',(0,r.handleSubmitEvent)(),(0,r.handleInputEvent)()}t.addEventListener("click",o),n.addEventListener("click",o)};var r=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r,a,o=(r=v(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.match(/^0\d{9}/g)){e.next=20;break}return e.prev=2,e.next=5,(0,p.generateHeaders)();case 5:return n=e.sent,console.log(n),e.next=9,fetch(f,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","User-Token":""+(localStorage.getItem("token")||sessionStorage.getItem("token")),"Client-Token":n["Client-Token"],"Time-Stamp":n["Time-Stamp"],"Time-Signature":n["Time-Signature"]},body:JSON.stringify({receiver_phone:t})}).then((function(e){return e.json()})).then((function(e){return e}));case 9:r=e.sent,console.log(r),h.parcels=r.map((function(e){var t=new Date(Date.parse(e.service_date)).toLocaleDateString().split("/");return e.service_date=t[2]+"-"+t[0]+"-"+t[1],console.log(e.service_date),e})),h.parcels.length?k():y(),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),w(e.t0);case 18:e.next=22;break;case 20:b("Phone number starts with 0 and is in 10 digits!");case 22:case"end":return e.stop()}}),e,this,[[2,15]])}))),function(e){return r.apply(this,arguments)}),i=(a=v(regeneratorRuntime.mark((function e(t){var n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=/^[eE][xX]\d{13}/g.exec(t))){e.next=18;break}return e.prev=2,e.next=5,(0,p.generateHeaders)();case 5:return r=e.sent,e.next=8,fetch(m,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","User-Token":""+(localStorage.getItem("token")||sessionStorage.getItem("token")),"client-token":r["client-token"],"time-stamp":r["time-stamp"],"time-signature":r["time-signature"]},body:JSON.stringify({shipmentIDs:[n[0]]})}).then((function(e){return e.json()})).then((function(e){return e}));case 8:a=e.sent,h.parcels=a.results,h.parcels.length?k():y(),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),w(e.t0);case 16:e.next=20;break;case 18:b("Your tracking ID is invalid!");case 20:case"end":return e.stop()}}),e,this,[[2,13]])}))),function(e){return a.apply(this,arguments)});t.handleSubmitEvent=function(){document.querySelector("form").onsubmit=function(e){e.preventDefault(),g()}},t.handleInputEvent=function(){document.querySelector("input").oninput=function(e){h.input=e.target.value,document.querySelector("#result_list ul").innerHTML="",h.timeoutId&&clearTimeout(h.timeoutId);var t=setTimeout((function(){g()}),500);h.timeoutId=t}};var s,c=n(7),u=n(8),l=n(1),d=(s=l)&&s.__esModule?s:{default:s},p=n(0);function v(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,o){try{var i=t[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}var f=""+d.default.searchParcelByPhone,m=""+d.default.searchParcelById,h={input:"",timeoutId:null,parcels:[]};function g(){var e=document.querySelector("input");"receiver_phone"===e.id?o(h.input):"tracking_id"===e.id&&i(h.input)}function b(e){document.querySelector("#result_list ul").innerHTML='\n    <li id="input_error" class="list-group-item" style="color: red; font-weight: bold;"></li>\n    ',document.querySelector("#input_error").innerText=e}function y(){document.querySelector("#result_list ul").innerHTML='\n    <li id="input_error" class="list-group-item" style="color: red; font-weight: bold;"></li>\n    ',document.querySelector("#input_error").innerText='No result from "'+h.input+'"'}function k(){var e=h.parcels.map((function(e){var t="",n="";switch(e.status.toLowerCase().trim()){case"pending":case"in hub":case"delivering":case"delivering (delay)":case"returning":case"re-deilvering":t="primary";break;case"delivered":case"delivered (delay)":case"returned":t="primary",n="disabled";break;case"canceled":case"failed delivery":case"not found":t="danger",n="disabled";break;default:t="primary"}return'\n        <div class="card" data-shipment-id="'+e.shipmentID+'">\n            <div class="card-body">\n                <h5 class="card-title">Parcel ID: '+e.shipmentID+'</h5>\n                <h6 class="card-subtitle mb-2 text-muted">Service Date: '+e.service_date+'</h6>\n                <h6 class="card-subtitle mb-2 text-muted">Delivery Status: '+e.status+'</h6>\n                <p class="card-text">'+e.receiver_name+" "+e.receiver_no+'</p>\n                <p class="card-text">'+e.dropoff_address+", "+e.dropoff_district+", "+e.dropoff_province+" "+e.dropoff_postcode+'</p>\n                <p class="card-text">'+e.note+'</p>\n                <div class="card-link btn btn-primary" data-type="photo">Photo</div>\n                <div class="card-link btn btn-'+t+" "+n+'" data-type="signature">Singature</div>\n            </div>\n        </div>\n        '})).join("");document.querySelector("#result_list ul").innerHTML=e,[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(document.querySelector(".list-group.list-group-flush").children)).forEach((function(e){e.querySelector("div[data-type=signature]").addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),(0,c.createSignaturePad)(e.dataset.shipmentId)})),e.querySelector("div[data-type=photo]").addEventListener("click",(function(t){t.preventDefault(),t.stopPropagation(),(0,u.createImageUploader)(e.dataset.shipmentId)}))}))}function w(e){var t=document.querySelector("header");t.innerHTML='\n    <div id="warning" class="alert alert-danger" role="alert">\n        Something went wrong: '+e+"\n    </div>\n    ",setTimeout((function(){t.innerHTML=""}),5e3)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createSignaturePad=function(e){var t=document.querySelector("footer");t.remove();var n=document.querySelector(".container"),r=document.createElement("div");r.className="modal-dialog modal-dialog-scrollable update-pod",r.innerHTML='\n    <div class="modal-content">\n        <div class="modal-header">\n            <h5 class="modal-title" id="exampleModalScrollableTitle">Tracking ID: '+e+'</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div id="signature_upload" class="signature-pad">\n                <div class="signature-pad--body">\n                    <canvas id="signature_canvas">This browser doesn\'t support canvas</canvas>\n                </div>\n                <div class="signature-pad--footer">\n                    <div class="description">Sign above</div>\n                    <div class="signature-pad--actions">\n                        <div>\n                            <button type="button" class="button clear" data-action="clear">Clear</button>\n                            <button type="button" class="button" data-action="undo">Undo</button>\n                        </div>\n                        <div>\n                            <button type="button" class="button save" data-action="save-png">Save\n                                as\n                                PNG</button>\n                            <button type="button" class="button save" data-action="save-jpg">Save\n                                as\n                                JPG</button>                            \n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary" data-action="upload-signature">Upload</button>\n        </div>\n    </div>\n    ';n.appendChild(r);var i=r.querySelector("[data-action=clear]"),c=r.querySelector("[data-action=undo]"),u=r.querySelector("[data-action=save-png]"),l=r.querySelector("[data-action=save-jpg]"),d=r.querySelector("#signature_canvas"),p=new SignaturePad(d,{backgroundColor:"rgb(255, 255, 255)"});function v(){d.width=d.offsetWidth,d.height=d.offsetHeight,d.getContext("2d"),p.clear()}function f(e,t){var n=function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],r=window.atob(t[1]),a=r.length,o=new Uint8Array(a),i=0;i<a;++i)o[i]=r.charCodeAt(i);return new Blob([o],{type:n})}(e),r=window.URL.createObjectURL(n),a=document.createElement("a");a.style="display: none",a.href=r,a.download=t,document.body.appendChild(a),a.click(),window.URL.revokeObjectURL(r)}function m(){r.remove(),n.insertAdjacentElement("afterend",t)}window.addEventListener("resize",v),v(),i.addEventListener("click",(function(e){p.clear()})),c.addEventListener("click",(function(e){var t=p.toData();t&&(t.pop(),p.fromData(t))})),u.addEventListener("click",(function(e){p.isEmpty()?alert("Please provide a signature first."):f(p.toDataURL(),"signature.png")})),l.addEventListener("click",(function(e){p.isEmpty()?alert("Please provide a signature first."):f(p.toDataURL("image/jpeg"),"signature.jpg")})),n.querySelector("[data-action=upload-signature]").onclick=(h=regeneratorRuntime.mark((function t(n){var r,i,c,u,l,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=p.toDataURL("image/jpeg"),!(i=(0,a.userToken)())){t.next=12;break}return t.next=5,(0,a.generateHeaders)();case 5:return c=t.sent,t.next=8,fetch(s,{method:"post",headers:{"Content-Type":"application/json","User-Token":""+i,"Client-Token":c["Client-Token"],"Time-Stamp":c["Time-Stamp"],"Time-Signature":c["Time-Signature"]},body:JSON.stringify({trackingID:e,type:"signature",PODImage:[r],fileName:"signatuer_"+e})}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){return alert(e)}));case 8:200===(u=t.sent).resCode&&u.result.length?(l="upload signature for "+e+" success!",console.log(l),alert(l),m()):(d="Error! Upload signature for "+e+" failed!",console.log(d),alert(d)),t.next=14;break;case 12:alert("token is invalid!"),(0,o.userLogin)();case 14:case"end":return t.stop()}}),t,this)})),g=function(){var e=h.apply(this,arguments);return new Promise((function(t,n){return function r(a,o){try{var i=e[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));t(s)}("next")}))},function(e){return g.apply(this,arguments)}),n.querySelector(".modal-header button").onclick=m,n.querySelector(".modal-footer button").onclick=m;var h,g};var r,a=n(0),o=n(2),i=n(1);var s=((r=i)&&r.__esModule?r:{default:r}).default.uploadEndpoint},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createImageUploader=function(e){var t=(r=i(regeneratorRuntime.mark((function t(){var n,r,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments[1];return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,a.userToken)(),t.next=3,(0,a.generateHeaders)();case 3:if(r=t.sent,!n){t.next=9;break}return t.next=7,fetch(s,{method:"post",headers:{"Content-Type":"application/json","User-Token":""+n,"Client-Token":r["Client-Token"],"Time-Stamp":r["Time-Stamp"],"Time-Signature":r["Time-Signature"]},body:JSON.stringify({trackingID:e,type:"image",PODImage:o,fileName:"pod_"+e+"_"+(new Date).toISOString()})}).then((function(e){return e.json()})).then((function(t){if(200===t.resCode&&t.result.length){var n=t.result.length>1?"images":"image",r="upload "+t.result.length+" "+n+" for "+e+" success!";console.log(r),alert(r),i.clearPreviewPanel(),d()}else{var a="upload image for "+e+" failed";console.log(a),alert(a)}})).catch((function(e){alert(e)}));case 7:t.next=11;break;case 9:alert("token is invalid!"),userLogin();case 11:case"end":return t.stop()}}),t,this)}))),function(){return r.apply(this,arguments)}),n=document.querySelector("footer");var r;n.remove();var o=document.querySelector(".container"),u=document.createElement("div");u.className="modal-dialog modal-dialog-scrollable update-pod",u.innerHTML='\n    <div class="modal-content">\n        <div class="modal-header">\n            <h5 class="modal-title" id="exampleModalScrollableTitle">Tracking ID: '+e+'</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div id="photo_upload">\n                <div class="custom-file-container" data-upload-id="imageUploader">\n                    <div class="image-upload-btns">\n                        <label class="custom-file-container__custom-file card shadow bg-white roundedcard shadow bg-white rounded">\n                            <div id="photo_btn">\n                                <img src="https://img.icons8.com/plasticine/camera.png" alt="photo_button">\n                                <p>Take a photo</p>\n                            </div>\n                            <input type="file" class="custom-file-container__custom-file__custom-file-input"\n                                accept="image/jpeg, image/png, image/gif" multiple aria-label="Choose File" style="display:none" />\n                            <input type="hidden" name="MAX_FILE_SIZE" value="10485760" style="display:none" />\n                            <span class="custom-file-container__custom-file__custom-file-control" style="display:none"></span>\n                        </label>\n                        \n                    </div>\n                    <div class="custom-file-container__image-preview"></div>\n                    <label><span>Remove All Photos</span>\n                            <a href="javascript:void(0)" class="custom-file-container__image-clear"\n                                title="Clear Image">&times;</a>\n                        </label>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary" data-action="upload-image">Upload</button>\n        </div>\n    </div>\n    ',o.appendChild(u);var l=new FileUploadWithPreview("imageUploader");function d(){u.remove(),o.insertAdjacentElement("afterend",n)}o.querySelector("[data-action=upload-image]").onclick=(p=i(regeneratorRuntime.mark((function e(n){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r=l.cachedFileArray).length&&r.forEach((function(e){var n=new FileReader;n.readAsDataURL(e),n.onload=function(e){var n=document.createElement("img");n.src=e.target.result,n.onload=function(e){var n=document.createElement("canvas"),a=400/e.target.width;n.width=400,n.height=e.target.height*a;var o=n.getContext("2d");o.drawImage(e.target,0,0,n.width,n.height);var i=o.canvas.toDataURL(e.target,"image/jpeg",.92);c.compressedFiles.push(i),c.compressedFiles.length===r.length&&t(c.compressedFiles,l)}}}));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)}),o.querySelector(".modal-header button").onclick=d,o.querySelector(".modal-footer button").onclick=d;var p};var r,a=n(0),o=n(1);function i(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,o){try{var i=t[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}var s=((r=o)&&r.__esModule?r:{default:r}).default.uploadEndpoint,c={files:[],compressedFiles:[]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;t.qrScanner=(r=a(regeneratorRuntime.mark((function e(){var t,n,r,i,s,c,u,l,d,p,v,f,m,h,g,b,y=(t=a(regeneratorRuntime.mark((function e(){var t,n,r,i,c,l,v;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u.style.display="none",p.style.display="none",s.hidden=!1,!/iphone|ipad|mac|apple|os\sx/.test(b().toLowerCase())){e.next=23;break}return t=function(){var e=a(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia({video:!0}).then(function(){var e=a(regeneratorRuntime.mark((function e(n){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:if(!(r=e.sent).length){e.next=12;break}return a=r.filter((function(e){return"videoinput"===e.kind})),o=d.value,d.innerHTML="",a.forEach((function(e,t){var n=document.createElement("option");n.value=e.deviceId,n.text=e.label||"camera "+(t+1),d.appendChild(n)})),d.value=o,e.abrupt("return",r);case 12:m(),console.log("trigger");case 14:case"end":return e.stop()}}),e,t)})));return function(t){return e.apply(this,arguments)}}()).catch(m);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}(),e.prev=5,window.stream&&window.stream.getTracks().forEach((function(e){e.stop()})),e.next=9,t();case 9:n=e.sent,r=n.filter((function(e){return"videoinput"===e.kind&&/(back|rear)/g.test(e.label.toLowerCase())})),i={},c=d.value,i=r.length?{video:{deviceId:c?{exact:c}:r[r.length-1].deviceId}}:{video:{deviceId:{exact:void 0}}},console.log(i),navigator.mediaDevices.getUserMedia(i).then(f).then(k).catch(m),e.next=21;break;case 18:e.prev=18,e.t0=e.catch(5),m(e.t0);case 21:e.next=24;break;case 23:try{if(window.stream&&window.stream.getTracks().forEach((function(e){e.stop()})),l=d.value,v=null,o.rearCameras.length)v={video:{deviceId:l?{exact:l}:{exact:o.rearCameras[o.rearCameras.length-1].deviceId}}},navigator.mediaDevices.getUserMedia(v).then(f).then(k).catch(m);else{v={video:{deviceId:void 0}};try{v={video:{facingMode:"environment"}},navigator.mediaDevices.getUserMedia(v).then(f).then(k).catch(m)}catch(e){console.log("no rear camera"),v={video:!0},navigator.mediaDevices.getUserMedia(v).then(f).then(k).catch(m)}}console.log(v)}catch(e){console.log(e)}case 24:case"end":return e.stop()}}),e,this,[[5,18]])}))),function(){return t.apply(this,arguments)}),k=(n=a(regeneratorRuntime.mark((function e(){var t,n,r,a;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices().then((function(e){return e})).catch((function(e){return e}));case 2:if(t=e.sent,!(n=t.filter((function(e){return"videoinput"===e.kind}))).length){e.next=14;break}return r=d.value,d.innerHTML="",n.forEach((function(e,t){var n=document.createElement("option");n.value=e.deviceId,n.text=e.label||"camera "+(t+1),d.appendChild(n)})),d.value=r,a=t.filter((function(e){return/(back|rear)/g.test(e.label.toLowerCase())})),o.rearCameras=a,e.abrupt("return",t);case 14:m("This device has no available camera");case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)});return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return b=function(){var e=navigator.userAgent.match(/\((.*?)\)/g)[0];return e=e.slice(1,e.length-1)},g=function e(){try{qrcode.decode()}catch(t){setTimeout(e,300)}},h=function e(){s.height=o.video.videoHeight,s.width=o.video.videoWidth,c.drawImage(o.video,0,0,s.width,s.height),o.scanning&&requestAnimationFrame(e)},m=function(e){var t="<h1>App can't start camera because </h1>\n            <p>\""+e+'"</p>\n            <div id="refresh_page" class="btn btn-light" style="margin: 0 auto;">Reload Page</div>';document.querySelector("#qrcode_scanner").innerHTML=t,document.querySelector("#refresh_page").addEventListener("click",(function(e){e.stopPropagation(),location.reload()})),console.log(e)},f=function(e){window.stream=e,o.scanning=!0,o.video.setAttribute("playsinline",!0),o.video.srcObject=e,o.video.play(),h(),g()},v=function(e){e&&(u.style.display="block",l.innerText=e,p.style.display="block",o.scanning=!1,o.video.srcObject.getTracks().forEach((function(e){e.stop()})),s.hidden=!0)},(r=document.querySelector(".container")).style.justifyContent="space-between",r.innerHTML='\n        <div id="qrcode_scanner">\n            <div>\n                <h1>QR Code Scanner</h1>\n            </div>\n            <div id="videoSelect">\n                <label for="videoSource">Change Camera</label>\n                <select id="videoSource" class="custom-select"></select>\n            </div>\n            <canvas id="qr-canvas"></canvas>\n            <div id="qr-result">\n                <b>Result:</b><span id="outputData"></span>\n            </div>\n            <div id="startScanBtn">\n                <label>\n                    <img src="https://uploads.sitepoint.com/wp-content/uploads/2017/07/1499401426qr_icon.svg">\n                    <p>Scan Again</p>\n                </label>\n            </div>\n        </div>\n    ',i=document.createElement("video"),o.video=i,(s=document.querySelector("#qr-canvas")).width=s.offsetHeight/3*4,c=s.getContext("2d"),u=document.querySelector("#qr-result"),l=document.querySelector("#outputData"),d=document.querySelector("#videoSource"),p=document.querySelector("#startScanBtn"),d.onchange=y,e.next=21,k();case 21:y(),qrcode.callback=v,p.onclick=y;case 25:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)});function a(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){return function r(a,o){try{var i=t[a](o),s=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}("next")}))}}t.stopStream=function(){o.scanning&&(o.video.srcObject.getTracks().forEach((function(e){e.stop()})),o.scanning=!1,o.video=null)};var o={rearCameras:[],cameras:[],appleDevice:null,scanning:!1,video:null}}]);