!function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(n){return e[n]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n,t){"use strict";t.r(n);const i="https://api.airportels.asia";var o={host:"",apiEndpoint:i,appEndpoint:"https://app.makesend.asia",checkToken:i+"/api/msd/authPing",uploadEndpoint:i+"/api/msd/delivery/uploadPOD",searchParcelByPhone:"/searchParcelByPhone",searchParcelById:"/searchParcelByTrackingId",requestOTPEndpoint:i+"/api/msd/password/recover/requestOTP",verifyOTPEndpoint:i+"/api/msd/password/recover/verifyOTP",changePasswordEndpoint:i+"/api/msd/password/recover",loginRequestOTPEndpoint:i+"/api/msd/user/password/change/requestOTP",loginVerifyOTPEndpoint:i+"/api/msd/user/password/change/verifyOTP",loginChangePasswordEndpoint:i+"/api/msd/user/password/change",createPreprintIdEndpoint:i+"/api/msd/qr/preprint/generate",checkPreprintIdEndpoint:i+"/api/msd/qr/preprint/check",registerPreprintIdEndpoint:i+"/api/msd/qr/preprint/register"};const a=o.host+"/header",r=o.host+"/login",s=o.checkToken;async function c(){try{return await fetch(a,{method:"post",mod:"cors",headers:{"Content-Type":"application/json"}}).then(e=>e.json()).then(e=>e)}catch(e){return console.log(e),null}}function d(){return sessionStorage.getItem("token")||localStorage.getItem("token")||null}async function l(){let e=!1;const n=d(),t=await c();if(n){200===(await fetch(s,{method:"post",mod:"cors",responseType:"json",headers:{"Content-Type":"application/json","User-Token":""+n,"Client-Token":t["Client-Token"],"Time-Stamp":t["Time-Stamp"],"Time-Signature":t["Time-Signature"]}}).then(e=>e.json()).then(e=>e).catch(e=>console.log(e))).resCode&&(e=!0)}return e}const u=document.querySelector(".container");function p(){sessionStorage.clear(),localStorage.clear(),window.location.hash="",u.innerHTML='\n        <div id="login_form">\n            <div id="makesend_logo">\n                <img src="https://www.makesend.asia/wp-content/uploads/2018/06/logo-makesend.png" alt="ms_logo">\n            </div>\n            <form action="" autocomplete="off">\n                <div class="mb-3">\n                    <label for="email" class="form-label">Email</label>\n                    <input type="text" class="form-control" id="email" aria-describedby="emailHelp"\n                        autocomplete="off">\n                    <div class="invalid-feedback">Your email is not correct</div>\n                </div>\n                <div class="mb-3">\n                    <label for="password" class="form-label">Password</label>\n                    <input type="password" class="form-control" id="password">\n                    <div class="invalid-feedback">Your password is not correct</div>\n                </div>\n                <div class="mb-3 form-check">\n                    <input type="checkbox" class="form-check-input" id="remember_me" checked>\n                    <label class="form-check-label" for="remember_me">Remember me</label>\n                </div>\n                <button type="submit" class="btn btn-warning">Login</button>\n                <div>\n                    <a href="#forgetpassword">Forget Password?</a>\n                </div>\n            </form>\n        </div>\n    ';const e=document.querySelector("#login_form"),n=document.querySelector("#email"),t=document.querySelector("#password"),i=document.querySelector("#remember_me");function o(){t.classList.remove("is-invalid"),n.classList.remove("is-invalid")}n.addEventListener("input",o),t.addEventListener("input",o),e.addEventListener("submit",(async function(e){e.preventDefault();const o=n.value,a=t.value;if(o&&a){if(o&&a){if(await async function(e="",n="",t=!1){let i=await c();const o=await fetch(r,{method:"post",headers:{"Content-type":"application/json","Client-Token":i["Client-Token"],"Time-Stamp":i["Time-Stamp"],"Time-Signature":i["Time-Signature"]},body:JSON.stringify({email:e,password:n,keepAlive:t?1:0})}).then(e=>e.json()).then(e=>e).catch(e=>e);return 200===o.resCode&&(t?localStorage.setItem("token",o.token):sessionStorage.setItem("token",o.token),window.location.hash="dashboard",!0)}(o,a,i.checked))return}n.classList.add("is-invalid"),t.classList.add("is-invalid")}else n.classList.add("is-invalid"),t.classList.add("is-invalid")}))}function m(e,n=window.location.href){e=e.replace(/[\[\]]/g,"\\$&");const t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(n);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}async function g(e=""){const n=/.?(([Ee][Xx]|[Ss][Tt]|[Pp]{2})\d{13}).?/g.exec(e),t=document.querySelector("#output_data"),i=document.querySelector("#parcel_status");if(i.innerHTML="",n){const o=n[1].toUpperCase();e.includes("http")?t.innerHTML=`\n            Parcel ID: <a href=${e}>${o}</a>\n            `:t.innerText=o,await async function(e="",n=null){if(e){const t=document.querySelector("#output_data"),i=m("id"),o=document.querySelector("#actionToResult");o.style.display="block";const a=o.querySelector("a");if(e.includes("ST"))a.setAttribute("href","#search?id="+e),a.innerText="Update Delivery Status";else if(e.includes("PP")){const r=await v(e);if(200===r.resCode&&r.registered){const{status:e}=await h(r.trackingID);f(e.toLowerCase(),r.trackingID,n,a)}else if(200===r.resCode){const n=i?"&trackingId="+i:"";a.setAttribute("href",`#registerqr?id=${e}${n}`),a.innerText="Register Parcel",n&&n.includes("EX")&&(window.location.hash=`#registerqr?id=${e}${n}`)}else console.log(r.message),alert(r.message),t.innerText="Invalid Tracking ID "+e,o.style.display="none"}else if(e.includes("EX")){const{status:t}=await h(e);f(t.toLowerCase(),e,n,a)}}}(o,i)}else e.includes("http")||e.includes("www")?t.innerHTML=`\n           <a href=${e}>${e}</a>\n        `:t.innerText=e}function f(e="",n="",t=null,i=null){if(!(e&&n&&i&&t))return null;t.innerText="Status: "+e,"pending"===e?(i.setAttribute("href","#search/trackingid?id="+n),i.innerText="Update Delivery Status"):"delivered"===e?(i.setAttribute("href",`${o.appEndpoint}/tracking?t=${n}`),i.innerText="Check Parcel POD"):(i.setAttribute("href","#search/trackingid?id="+n),i.innerText="Search Parcel")}async function h(e=""){const n=/.?(([Ee][Xx]|[Ss][Tt]|[Pp]{2})\d{13}).?/g.exec(e)[1].toUpperCase();if(n){const e=await c(),t=await fetch(o.searchParcelById,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","User-Token":""+(localStorage.getItem("token")||sessionStorage.getItem("token")),"Client-Token":e["Client-Token"],"Time-Stamp":e["Time-Stamp"],"Time-Signature":e["Time-Signature"]},body:JSON.stringify({trackingId:n})}).then(e=>e.json()).then(e=>e).catch(e=>e);return{trackingId:t[0].shipmentID,status:t[0].status}}return null}async function v(e=""){if(e){const n=localStorage.getItem("token"),t=await c(),i=await fetch(o.checkPreprintIdEndpoint,{method:"post",mod:"cors",responseType:"json",headers:{"Content-Type":"application/json","User-Token":""+n,"Client-Token":t["Client-Token"],"Time-Stamp":t["Time-Stamp"],"Time-Signature":t["Time-Signature"]},body:JSON.stringify({qr:e})}).then(e=>e.json()).then(e=>e).catch(e=>e);return console.log(i),i}return null}const y={rearCameras:[],cameras:[],appleDevice:null,scanning:!1,video:null,stream:null};async function b(){const e=document.querySelector("header");e.style.display="block",e.innerHTML='\n        <div id="header">QR Reader</div>\n    ';const n=document.querySelector(".container");n.style.justifyContent="space-between",n.innerHTML='\n        <div id="qrcode_scanner">\n            <div id="videoSelect">\n                <label for="videoSource">Change Camera</label>\n                <select id="videoSource" class="custom-select"></select>\n            </div>\n            <canvas id="qr-canvas" hidden></canvas>\n            <div id="qr-result">\n                <b>Result: </b>\n                <p id="output_data">https://app.makesend.asia/tracking?t=PP2103151042875</p>\n                <p id="parcel_status">Status: <span>pending</span></p>\n            </div>\n            <div id="actionToResult">\n                <a href="#" class="btn btn-primary">action</a>\n                <hr>\n            </div>\n            <div id="startScanBtn">\n                <label>\n                    <img src="https://uploads.sitepoint.com/wp-content/uploads/2017/07/1499401426qr_icon.svg">\n                    <p>Scan Again</p>\n                </label>\n            </div>\n        </div>\n    ',y.video=document.createElement("video");const t=document.querySelector("#qr-canvas");t.width=t.offsetHeight/3*4;const i=t.getContext("2d"),o=document.querySelector("#qr-result"),a=document.querySelector("#videoSource"),r=document.querySelector("#actionToResult"),s=document.querySelector("#startScanBtn");async function c(){if(o.style.display="none",s.style.display="none",r.style.display="none",t.hidden=!1,/iphone|ipad|mac|apple|os\sx/.test(function(){let e=navigator.userAgent.match(/\((.*?)\)/g)[0];return e=e.slice(1,e.length-1),e}().toLowerCase())){try{y.stream&&y.stream.getTracks().forEach(e=>{e.stop()});const e=(await async function(){return await navigator.mediaDevices.getUserMedia({video:!0}).then(async e=>{const n=await navigator.mediaDevices.enumerateDevices();if(n.length){const e=n.filter(e=>"videoinput"===e.kind),t=a.value;return a.innerHTML="",e.forEach((e,n)=>{console.log(e);const t=document.createElement("option");t.value=e.deviceId,t.text=e.label||"camera "+(n+1),a.appendChild(t)}),a.value=t,n}u(),console.log("trigger")}).catch(u)}()).filter(e=>"videoinput"===e.kind&&/(back|rear)/g.test(e.label.toLowerCase()));let n={};const t=a.value;n=e.length?{video:{deviceId:t?{exact:t}:e[e.length-1].deviceId}}:{video:{deviceId:{exact:void 0}}},console.log(n),navigator.mediaDevices.getUserMedia(n).then(l).then(d).catch(u)}catch(e){u(e)}}else try{y.stream&&y.stream.getTracks().forEach(e=>{e.stop()});const e=a.value;let n=null;if(y.rearCameras.length)n={video:{deviceId:e?{exact:e}:{exact:y.rearCameras[y.rearCameras.length-1].deviceId}}},navigator.mediaDevices.getUserMedia(n).then(l).then(d).catch(u);else{n={video:{deviceId:void 0}};try{n={video:{facingMode:"environment"}},navigator.mediaDevices.getUserMedia(n).then(l).then(d).catch(u)}catch(e){console.log("no rear camera"),n={video:!0},navigator.mediaDevices.getUserMedia(n).then(l).then(d).catch(u)}}console.log(n)}catch(e){console.log(e)}}async function d(){const e=await navigator.mediaDevices.enumerateDevices().then(e=>e).catch(e=>e),n=e.filter(e=>"videoinput"===e.kind);if(n.length){const t=a.value;a.innerHTML="",n.forEach((e,n)=>{const t=document.createElement("option");t.value=e.deviceId,t.text=e.label||"camera "+(n+1),a.appendChild(t)}),a.value=t;const i=e.filter(e=>/(back|rear)/g.test(e.label.toLowerCase()));return y.rearCameras=i,e}u("This device has no available camera")}function l(e){y.stream=e,y.scanning=!0,y.video.setAttribute("playsinline",!0),y.video.srcObject=e,y.video.play(),p(),m()}function u(e){let n=`<h1>App can't start camera because </h1>\n            <p>"${e}"</p>\n            <div id="refresh_page" class="btn btn-light" style="margin: 0 auto;">Reload Page</div>`;document.querySelector("#qrcode_scanner").innerHTML=n,document.querySelector("#refresh_page").addEventListener("click",(function(e){e.stopPropagation(),location.reload()})),console.log(e)}function p(){y.scanning&&(t.height=y.video.videoHeight,t.width=y.video.videoWidth,i.drawImage(y.video,0,0,t.width,t.height),y.scanning&&requestAnimationFrame(p))}function m(){try{qrcode.decode()}catch(e){setTimeout(m,300)}}a.onchange=c,await d(),await c(),qrcode.callback=async function(e){e&&(o.style.display="block",s.style.display="block",y.scanning&&(y.video.srcObject.getTracks().forEach(e=>{e.stop()}),y.stream.getTracks().forEach(e=>{e.stop()})),y.scanning=!1,t.hidden=!0,async function(e){g(e.toString().trim().toLowerCase())}(e))},s.onclick=c}function T(e="dashboard"){const n=document.querySelector(".container"),t=document.querySelector("footer");n.innerHTML="",t.innerHTML='\n        <div class="navigator">\n            <div>\n                <a href="#scanner" class="" id="navi_scanner">\n                    <i class="fas fa-qrcode"></i>\n                    <span>Scan</span>\n                </a>\n            </div>\n            <div>\n                <a href="#search" class="" id="navi_search">\n                    <i class="fas fa-search"></i>\n                    <span>Search</span>\n                </a>\n            </div>\n            <div>\n                <a href="#tasks" class="" id="navi_tasks">\n                    <i class="fas fa-tasks"></i>\n                    <span>Tasks</span>\n                </a>\n            </div>\n            <div>\n                <a href="#setting" class="" id="navi_setting">\n                    <i class="fas fa-cog"></i>\n                    <span>Setting</span>\n                </a>\n            </div>\n        </div>\n    ',function(e){const n=document.querySelector("#navi_scanner"),t=document.querySelector("#navi_search"),i=document.querySelector("#navi_tasks"),o=document.querySelector("#navi_setting");switch([i,t,n,o].forEach(e=>{e.classList.remove("selected")}),e){case"dashboard":t.classList.add("selected");break;case"scanner":n.classList.add("selected");break;case"tasks":i.classList.add("selected");break;case"setting":o.classList.add("selected");break;default:t.classList.add("selected")}}(e)}const S={otp:"",ref:"",pending:60,driverPhone:null,timeStamp:0,countdownTimer:null};function w(){document.querySelector(".container").innerHTML='\n    <div id="login_form">\n        <div id="makesend_logo">\n            <img src="https://www.makesend.asia/wp-content/uploads/2018/06/logo-makesend.png" alt="ms_logo">\n        </div>\n        <h1>Reset Password</h1>\n        <hr>\n        <div id="phone_otp_input">\n        </div>\n        <hr>\n        <div id="backToLogin">\n            <a class="btn btn-primary" href="#">Back to Login</a>\n        </div>\n    </div>\n    ';const e=document.querySelector("#phone_otp_input");if(e){const n='\n        <form action="" method="post" id="submit_phone">\n            <label for="driver_phone" class="form-label">Please enter your phone</label>\n            <div>\n                <input class="form-control" id="driver_phone" type="tel" name="receiver_phone" value=""\n                    inputmode="numeric" placeholder="#0632166699" autocomplete="off" pattern="[0-9]{10}">\n                <button type="submit"><i class="fa fa-search"></i></button>\n                <div id="error_hint" class="invalid-feedback">Phone number starts with 0 and has 10 digits!</div>\n            </div>\n        </form>\n        ';e.innerHTML=n;const t=e.querySelector("#submit_phone");if(e&&t){t.onsubmit=async function t(i){i.stopPropagation(),i.preventDefault();const a=i.target.querySelector("input");a.oninput=function(){this.classList.remove("is-invalid")};const r=a.value;if(/^0\d{9}/g.test(r)){e.innerHTML=_();const i=await async function(e=""){const n=await P(),t=/[06](\d{9})/g.exec(e);if(t){return await fetch(o.requestOTPEndpoint,{method:"post",mod:"cors",headers:{"Content-Type":"application/json","Client-Token":n.clientToken,"Time-Stamp":n.timeStamp,"Time-Signature":n.timeSignature},body:JSON.stringify({phone:"+66"+t[1]})}).then(e=>e.json()).then(e=>e).catch(e=>e)}return null}(r);if(200===i.resCode)console.log(i),S.ref=i.otpRef,S.driverPhone=r,S.timeStamp=(new Date).getTime(),e.innerHTML=q(S.driverPhone),k(),function e(){const n=document.querySelector("#phone_otp_input"),t=document.querySelector(".digit-group").querySelectorAll("input");t.length&&(t[0].focus(),t.forEach(t=>{t.onchange=async function(t){const i=this.parentNode,o=t.target.value;if(document.querySelector("#invalid_otp").innerText="",o){const e=i.querySelector("input#"+this.dataset.next);e&&e.focus()}else if(o){if(S.otp="",formTag.querySelectorAll("input").forEach(e=>{S.otp+=e.value}),4===S.otp.length){const t=S.otp;n.innerHTML=_();const i=await L(t,S.ref);if(200===i.resCode)console.log(i),C();else{n.innerHTML=q(S.driverPhone,S.pending);document.querySelector("#invalid_otp").innerText="Invalid OTP Code!",e(),k()}}}else{const e=i.querySelector("input#"+this.dataset.previous);e&&e.focus()}},t.onkeyup=async function(t){const i=this.parentNode,o=i.parentNode;if(document.querySelector("#invalid_otp").innerText="",8===t.keyCode||37===t.keyCode){const e=i.querySelector("input#"+this.dataset.previous);e&&e.focus()}else if(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=65&&t.keyCode<=90||t.keyCode>=96&&t.keyCode<=105||39===t.keyCode){const t=i.querySelector("input#"+this.dataset.next);if(t)t.focus();else if(S.otp="",o.querySelectorAll("input").forEach(e=>{S.otp+=e.value}),4===S.otp.length){const t=S.otp;n.innerHTML=_();const i=await L(t,S.ref);if(200===i.resCode)console.log(i),C();else{n.innerHTML=q(S.driverPhone,S.pending);document.querySelector("#invalid_otp").innerText="Invalid OTP Code!",e(),k()}}}}}))}();else{e.innerHTML=n;e.querySelector("#submit_phone").onsubmit=t,console.log(i.message),alert(i.message)}}else a.classList.add("is-invalid")}}}}function k(e=60){S.countdownTimer&&clearTimeout(S.countdownTimer);const n=document.querySelector("#countdown");if(n){const e=(new Date).getTime();let t=S.pending,i=Math.floor((e-S.timeStamp)/1e3);if(i>=60?t=0:i<60&&60!==t&&(t=60-i),t>0)S.pending=t-1,n.innerText=S.pending,S.countdownTimer=setTimeout((function(){k(S.pending)}),1e3);else{const e=document.querySelector("#insert_otp button");e.removeAttribute("disabled"),n.parentNode.innerHTML="",e.onclick=function(n){n.preventDefault(),S.pending=60,e.setAttribute("disabled",!0),document.querySelector("#insert_otp button span").innerHTML=`(<span id="countdown">${S.pending}</span> sec)`,k(S.pending)}}}}function _(){return'\n        <div id="otp_loader">\n            <div class="spinner-border text-warning" style="width:3rem; height:3rem;" role="status">\n                <span class="visually-hidden">Loading...</span>\n            </div>\n            <h4>Loading...</h4>\n        </div>\n    '}function q(e=null,n=60){return`\n    <form class="digit-group" data-group-name="digits" autocomplete="off" id="insert_otp">\n        <div>\n            <h3>Enter OTP Code</h3>\n            <h3>Phone: ${e}</h3>\n        </div>\n        <div>\n            <input autocomplete="off" type="text" inputmode="numeric" id="digit-1" name="digit-1" data-next="digit-2" maxlength="1" />\n            <input autocomplete="off" type="text" inputmode="numeric" id="digit-2" name="digit-2" data-next="digit-3" data-previous="digit-1"\n                maxlength="1" />\n            <input autocomplete="off" type="text" inputmode="numeric" id="digit-3" name="digit-3" data-next="digit-4" data-previous="digit-2"\n                maxlength="1" />\n            <input autocomplete="off" type="text" inputmode="numeric" id="digit-4" name="digit-4" data-previous="digit-3" maxlength="1" />\n        </div>\n        <div id="invalid_otp"></div>\n        <div>\n            <button class="btn btn-warning" type="submit" disabled>Request OTP <span>(<span id="countdown">${n}</span> sec)</span></button>\n        </div>\n    </form>\n    `}function C(){document.querySelector("#phone_otp_input").innerHTML='\n        <form action="" autocomplete="off" id="reset_password_form">\n            <div class="mb-3">\n                <label for="password" class="form-label">New Password</label>\n                <input type="password" class="form-control" id="password" required>\n                <div class="invalid-feedback">Your password do not match</div>\n            </div>\n            <div class="mb-3">\n                <label for="password_repeat" class="form-label">Confirm password</label>\n                <input type="password" class="form-control" id="password_repeat" required>\n                <div class="invalid-feedback">Your password do not match</div>\n            </div>\n            <div>\n                <button type="submit" class="btn btn-warning">Reset Password</button>\n            </div>\n        </form>\n    ';const e=document.querySelector("#reset_password_form"),n=e.querySelector("button"),t=[...e.querySelectorAll("input")];t.forEach(e=>{e.oninput=function(){t.forEach(e=>{e.classList.remove("is-invalid")})}}),n.onclick=async function(e){e.preventDefault();const n=t.map(e=>e.value?e.value:null);if(n[0]===n[1]&&n[0]){const e=await async function(e="",n="",t="",i=""){const a=await P();if(t){return await fetch(o.changePasswordEndpoint,{method:"post",mod:"cors",headers:{"Content-Type":"application/json","Client-Token":a.clientToken,"Time-Stamp":a.timeStamp,"Time-Signature":a.timeSignature},body:JSON.stringify({otp:e,ref:n,password:t,confirmPassword:i})}).then(e=>e.json()).then(e=>e).catch(e=>e)}return null}(S.otp,S.ref,n[0],n[1]);200===e.resCode?(alert(e.message),window.location.hash=""):(console.log(e.message),alert(e.message))}else t.forEach(e=>{e.classList.add("is-invalid")})}}async function L(e="",n=""){const t=await P();if(e&&n){return await fetch(o.verifyOTPEndpoint,{method:"post",mod:"cors",headers:{"Content-Type":"application/json","Client-Token":t.clientToken,"Time-Stamp":t.timeStamp,"Time-Signature":t.timeSignature},body:JSON.stringify({otp:e,ref:n})}).then(e=>e.json()).then(e=>e).catch(e=>e)}return null}async function P(){const e={clientToken:"",timeStamp:"",timeSignature:""},n=await c();return n?(e.clientToken=n["Client-Token"],e.timeStamp=n["Time-Stamp"],e.timeSignature=n["Time-Signature"],e):null}const x=o.uploadEndpoint;function I(e){const n=document.querySelector("footer");n.remove();const t=document.querySelector(".container"),i=document.createElement("div");i.className="modal-dialog modal-dialog-scrollable update-pod",i.innerHTML=`\n    <div class="modal-content">\n        <div class="modal-header">\n            <h5 class="modal-title" id="exampleModalScrollableTitle">Tracking ID: ${e}</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div id="signature_upload" class="signature-pad">\n                <div class="signature-pad--body">\n                    <canvas id="signature_canvas">This browser doesn't support canvas</canvas>\n                </div>\n                <div class="signature-pad--footer">\n                    <div class="description">Sign above</div>\n                    <div class="signature-pad--actions">\n                        <div>\n                            <button type="button" class="button clear" data-action="clear">Clear</button>\n                            <button type="button" class="button" data-action="undo">Undo</button>\n                        </div>\n                        <div>\n                            <button type="button" class="button save" data-action="save-png">Save\n                                as\n                                PNG</button>\n                            <button type="button" class="button save" data-action="save-jpg">Save\n                                as\n                                JPG</button>                            \n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary" data-action="upload-signature">Upload</button>\n        </div>\n    </div>\n    `;t.appendChild(i);const o=i.querySelector("[data-action=clear]"),a=i.querySelector("[data-action=undo]"),r=i.querySelector("[data-action=save-png]"),s=i.querySelector("[data-action=save-jpg]"),l=i.querySelector("#signature_canvas"),u=new SignaturePad(l,{backgroundColor:"rgb(255, 255, 255)"});function m(){l.width=l.offsetWidth,l.height=l.offsetHeight,l.getContext("2d"),u.clear()}function g(e,n){const t=function(e){const n=e.split(";base64,"),t=n[0].split(":")[1],i=window.atob(n[1]),o=i.length,a=new Uint8Array(o);for(let e=0;e<o;++e)a[e]=i.charCodeAt(e);return new Blob([a],{type:t})}(e),i=window.URL.createObjectURL(t),o=document.createElement("a");o.style="display: none",o.href=i,o.download=n,document.body.appendChild(o),o.click(),window.URL.revokeObjectURL(i)}window.addEventListener("resize",m),m(),o.addEventListener("click",(function(e){u.clear()})),a.addEventListener("click",(function(e){const n=u.toData();n&&(n.pop(),u.fromData(n))})),r.addEventListener("click",(function(e){if(u.isEmpty())alert("Please provide a signature first.");else{g(u.toDataURL(),"signature.png")}})),s.addEventListener("click",(function(e){if(u.isEmpty())alert("Please provide a signature first.");else{g(u.toDataURL("image/jpeg"),"signature.jpg")}}));t.querySelector("[data-action=upload-signature]").onclick=async function(n){const t=u.toDataURL("image/jpeg"),i=d();if(i){const n=await c(),o=await fetch(x,{method:"post",headers:{"Content-Type":"application/json","User-Token":""+i,"Client-Token":n["Client-Token"],"Time-Stamp":n["Time-Stamp"],"Time-Signature":n["Time-Signature"]},body:JSON.stringify({trackingID:e,type:"signature",PODImage:[t],fileName:"signatuer_"+e})}).then(e=>e.json()).then(e=>e).catch(e=>alert(e));if(200===o.resCode&&o.result.length){const n=`upload signature for ${e} success!`,t=await Y(e);console.log(H),H[e]!==t&&(/^\d{10}$/g.test(H.input)?A(H.input):/^[eE][xX]\d{13}$/g.test(H.input)&&N(H.input)),alert(n),f()}else{const n=`Error! Upload signature for ${e} failed!`;console.log(n),alert(n)}}else alert("token is invalid!"),p()};t.querySelector(".modal-header button").onclick=f;function f(){i.remove(),t.insertAdjacentElement("afterend",n)}t.querySelector(".modal-footer button").onclick=f}const E=o.uploadEndpoint,D={files:[],compressedFiles:[]};function M(e){const n=document.querySelector("footer");n.remove();const t=document.querySelector(".container"),i=document.createElement("div");i.className="modal-dialog modal-dialog-scrollable update-pod",i.innerHTML=`\n    <div class="modal-content">\n        <div class="modal-header">\n            <h5 class="modal-title" id="exampleModalScrollableTitle">Tracking ID: ${e}</h5>\n            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n        </div>\n        <div class="modal-body">\n            <div id="photo_upload">\n                <div class="custom-file-container" data-upload-id="imageUploader">\n                    <div class="image-upload-btns">\n                        <label class="custom-file-container__custom-file card shadow bg-white roundedcard shadow bg-white rounded">\n                            <div id="photo_btn">\n                                <img src="https://img.icons8.com/plasticine/camera.png" alt="photo_button">\n                                <p>Take a photo</p>\n                            </div>\n                            <input type="file" class="custom-file-container__custom-file__custom-file-input"\n                                accept="image/jpeg, image/png, image/gif" multiple aria-label="Choose File" style="display:none" />\n                            <input type="hidden" name="MAX_FILE_SIZE" value="10485760" style="display:none" />\n                            <span class="custom-file-container__custom-file__custom-file-control" style="display:none"></span>\n                        </label>\n                        \n                    </div>\n                    <div class="custom-file-container__image-preview"></div>\n                    <label><span>Remove All Photos</span>\n                            <a href="javascript:void(0)" class="custom-file-container__image-clear"\n                                title="Clear Image">&times;</a>\n                        </label>\n                </div>\n            </div>\n        </div>\n        <div class="modal-footer">\n            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>\n            <button type="button" class="btn btn-primary" data-action="upload-image">Upload</button>\n        </div>\n    </div>\n    `,t.appendChild(i);let o=new FileUploadWithPreview("imageUploader");t.querySelector("[data-action=upload-image]").onclick=async function(n){const t=o.cachedFileArray;t.length&&t.forEach(n=>{const i=new FileReader;i.readAsDataURL(n),i.onload=function(n){const i=document.createElement("img");i.src=n.target.result,i.onload=function(n){const i=document.createElement("canvas"),r=400/n.target.width;i.width=400,i.height=n.target.height*r;const s=i.getContext("2d");s.drawImage(n.target,0,0,i.width,i.height);const l=s.canvas.toDataURL(n.target,"image/jpeg",.92);D.compressedFiles.push(l),D.compressedFiles.length===t.length&&async function(n=[],t){const i=d(),o=await c();if(i){const r=await fetch(E,{method:"post",headers:{"Content-Type":"application/json","User-Token":""+i,"Client-Token":o["Client-Token"],"Time-Stamp":o["Time-Stamp"],"Time-Signature":o["Time-Signature"]},body:JSON.stringify({trackingID:e,type:"image",PODImage:n,fileName:`pod_${e}_${(new Date).toISOString()}`})}).then(e=>e.json()).then(e=>e).catch(e=>alert(e));if(200===r.resCode&&r.result.length){const n=r.result.length>1?"images":"image",i=`upload ${r.result.length} ${n} for ${e} success!`,o=await Y(e);console.log(H),H[e]!==o&&(/^\d{10}$/g.test(H.input)?A(H.input):/^[eE][xX]\d{13}$/g.test(H.input)&&N(H.input)),console.log(i),alert(i),t.clearPreviewPanel(),a()}else{const n=`upload image for ${e} failed`;console.log(n),alert(n)}}else alert("token is invalid!"),userLogin()}(D.compressedFiles,o)}}})};t.querySelector(".modal-header button").onclick=a;function a(){i.remove(),t.insertAdjacentElement("afterend",n)}t.querySelector(".modal-footer button").onclick=a}const $=""+o.searchParcelByPhone,j=""+o.searchParcelById,H={input:"",timeoutId:null,parcels:[],allParcelStatus:null};function O(){document.querySelector("form").onsubmit=function(e){e.preventDefault(),U()}}function R(){document.querySelector("input").oninput=function(e){H.input=e.target.value,document.querySelector("#result_list ul").innerHTML="",H.timeoutId&&clearTimeout(H.timeoutId);const n=setTimeout((function(){U()}),300);H.timeoutId=n}}function U(){const e=document.querySelector("input");"receiver_phone"===e.id?A(H.input):"tracking_id"===e.id&&N(H.input)}async function A(e){if(e.match(/^0\d{9}/g))try{const n=await c(),t=await fetch($,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","User-Token":""+(localStorage.getItem("token")||sessionStorage.getItem("token")),"Client-Token":n["Client-Token"],"Time-Stamp":n["Time-Stamp"],"Time-Signature":n["Time-Signature"]},body:JSON.stringify({receiver_phone:e})}).then(e=>e.json()).then(e=>e);H.allParcelStatus=t.reduce((e,n)=>(e[n.shipmentID]={id:n.shipmentID,status:n.status.toLowerCase()},e),{}),H.parcels=t.map(e=>{const n=new Date(Date.parse(e.service_date)).toLocaleDateString().split("/");return e.service_date=`${n[2]}-${n[0]}-${n[1]}`,e}),H.parcels.length?X():B()}catch(e){F(e)}else{J("Phone number starts with 0 and is in 10 digits!")}}async function N(e){const n=/^[eE][xX]\d{13}/g.exec(e);if(n)try{const e=await c(),t=await fetch(j,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","User-Token":""+(localStorage.getItem("token")||sessionStorage.getItem("token")),"Client-Token":e["Client-Token"],"Time-Stamp":e["Time-Stamp"],"Time-Signature":e["Time-Signature"]},body:JSON.stringify({trackingId:n[0]})}).then(e=>e.json()).then(e=>e);if(H.parcels=t.map(e=>{const n=new Date(Date.parse(e.service_date)).toLocaleDateString().split("/");return e.service_date=`${n[2]}-${n[0]}-${n[1]}`,e}),H.parcels.length)return X(),t;B()}catch(e){F(e)}else{J("Your tracking ID is invalid!")}}function J(e){document.querySelector("#result_list ul").innerHTML='\n    <li id="input_error" class="list-group-item" style="color: red; font-weight: bold;"></li>\n    ',document.querySelector("#input_error").innerText=e}function B(){document.querySelector("#result_list ul").innerHTML='\n    <li id="input_error" class="list-group-item" style="color: red; font-weight: bold;"></li>\n    ',document.querySelector("#input_error").innerText=`No result from "${H.input}"`}function X(){const e=H.parcels.map(e=>`\n        <li class="list-group-item">\n            <div class="card" data-shipment-id="${e.shipmentID}">\n                <div class="card-body">\n                    <h5 class="card-title">Parcel ID: ${e.shipmentID}</h5>\n                    <h6 class="card-subtitle mb-2 text-muted">Service Date: ${e.service_date}</h6>\n                    <h6 class="card-subtitle mb-2 text-muted">Delivery Status: ${e.status}</h6>\n                    <p class="card-text">${e.receiver_name} ${e.receiver_no}</p>\n                    <p class="card-text">${e.dropoff_address}, ${e.dropoff_district}, ${e.dropoff_province} ${e.dropoff_postcode}</p>\n                    <p class="card-text">${e.note}</p>\n                    <div>\n                        ${function(e="",n=""){if(e&&n){let t="",i="",o="";switch(e){case"pending":case"in hub":case"delivering":case"delivering (delay)":case"returning":case"re-deilvering":i="primary";break;case"delivered":case"delivered (delay)":case"returned":i="primary",o="disabled";break;case"canceled":case"failed delivery":case"not found":i="danger",o="disabled";break;default:i="primary"}return t=`\n        <div class="card-link btn btn-${i} ${o}" data-type="photo">Photo</div>\n        <div class="card-link btn btn-${i} ${o}" data-type="signature">Singature</div>\n        <div class="card-link btn btn-${i} ${o}">\n            <a href="#scanner?id=${n}">\n                Scan_QR\n            </a>\n        </div>\n        <div class="card-link btn btn-${i} ${o}">\n            <a href="#registerqr?trackingId=${n}">\n                Pair_ID\n            </a>\n        </div>\n        `,t}return null}(e.status.trim().toLowerCase(),e.shipmentID)}\n                    </div>\n                </div>\n            </div>\n        </li>\n        `).join("");document.querySelector("#result_list ul").innerHTML=e;[...document.querySelector(".list-group.list-group-flush").children].forEach(e=>{const n=e.querySelector(".card");e.querySelector("div[data-type=signature]").addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),I(n.dataset.shipmentId)}));e.querySelector("div[data-type=photo]").addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),M(n.dataset.shipmentId)}))})}function F(e){const n=document.querySelector("header");n.innerHTML=`\n    <div id="warning" class="alert alert-danger" role="alert">\n        Something went wrong: ${e}\n    </div>\n    `,setTimeout((function(){n.innerHTML=""}),30)}async function Y(e=""){if(e){const n=await c(),t=await fetch(j,{method:"POST",mode:"cors",headers:{"Content-Type":"application/json","User-Token":""+(localStorage.getItem("token")||sessionStorage.getItem("token")),"Client-Token":n["Client-Token"],"Time-Stamp":n["Time-Stamp"],"Time-Signature":n["Time-Signature"]},body:JSON.stringify({trackingId:e})}).then(e=>e.json()).then(e=>e).catch(e=>e);if(t.length)return t[0].status.toLowerCase()}return null}const Q={id:null,phone:"",parcelId:null};function V(){const e=document.querySelector("header");e.style.display="block",e.innerHTML='\n        <div id="header">Search parcel</div>\n    ';const n='\n    <form action="">\n        <input class="form-control" id="receiver_phone" type="tel" name="receiver_phone" value=""\n            inputmode="numeric" placeholder="#0632166699" autocomplete="off" pattern="[0-9]{10}">\n        <button type="submit"><i class="fa fa-search"></i></button>\n    </form>\n    ';let t=n;const i=window.location.hash.split("?")[0];Q.id=m("id"),Q.parcelId=m("parcelId"),Q.phone=m("phone");let o="warning",a="dark";i.includes("trackingid")?(t='\n    <form action="" class="form-group">\n        <input class="form-control" id="tracking_id" type="text" name="tracking_id" value=""\n            placeholder="#EX1234567890123" autocomplete="off">\n        <button type="submit"><i class="fa fa-search"></i></button>        \n    </form>\n    ',o="dark",a="warning"):t=n;const r=document.querySelector(".container");if(r.style.justifyContent="space-between",r.innerHTML=`\n    <div id="search_parcel">\n        <div id="search_functions">\n            <div id="search_by_phone_btn" class="btn btn-${o}">Receiver Phone</div>\n            <div id="search_by_tracking_id_btn" class="btn btn-${a}">Tracking ID</div>\n        </div>\n        <div id="search_list">\n            <div id="search_bar">\n                ${t}\n            </div>            \n        </div>\n        <div id="search_filters">\n        </div>\n        <div id="result_list">\n            <ul class="list-group list-group-flush">\n                <li class="list-group-item">Please search parcel by <br> <b>Receiver Phone</b> or <br> <b>Tracking ID</b></li>\n            </ul>\n        </div>\n    </div>\n    `,O(),R(),Q.id){document.querySelector("#search_bar").querySelector("input").value=Q.id,N(Q.id)}else if(Q.phone){document.querySelector("#search_bar").querySelector("input").value=Q.phone,A(Q.phone)}const s=document.querySelector("#search_by_phone_btn"),c=document.querySelector("#search_by_tracking_id_btn");function d(e){e.stopPropagation();[...this.parentNode.children].forEach(e=>{e===this?(e.classList.add("btn-warning"),e.classList.remove("btn-dark")):(e.classList.add("btn-dark"),e.classList.remove("btn-warning"))}),"search_by_tracking_id_btn"===this.id?(document.querySelector("#search_by_tracking_id_btn").classList.add("btn-warning"),document.querySelector("#search_by_phone_btn").classList.add("btn-dark"),window.location.hash="search/trackingid"):"search_by_phone_btn"===this.id&&(window.location.hash="search/phone"),document.querySelector("#result_list ul").innerHTML='<li class="list-group-item">Please search parcel by <br> <b>Receiver Phone</b> or <br> <b>Tracking ID</b></li>',O(),R()}s.addEventListener("click",d),c.addEventListener("click",d)}function G(){const e=document.querySelector("header");e.style.display="block",e.innerHTML='\n        <div id="header">SETTINGS</div>\n    ';document.querySelector(".container").innerHTML='\n        <div id="setting">\n            <div id="search_setting">\n                <form action="">\n                    <input id="search_input" type="text" name="search_input" value="" placeholder="Search Setting...">\n                    <button type="submit"><i class="fa fa-search"></i></button>\n                </form>\n            </div>\n            <div id="setting_list">\n                <h3>Account Setting</h3>                        \n                <ul class="list-group list-group-flush">\n                <li class="list-group-item">\n                    <a href="#setting/userprofile">\n                        <div>\n                            <i class="fas fa-user"></i>\n                        </div>\n                        <div>User Profile</div>\n                        <div>\n                            <i class="fas fa-greater-than"></i>\n                        </div>\n                    </a>\n                </li>\n                <li class="list-group-item">\n                    <a href="#setting/resetpassword">\n                        <div>\n                            <i class="fas fa-lock"></i>\n                        </div>\n                        <div>Reset Password</div>\n                        <div>\n                            <i class="fas fa-greater-than"></i>\n                        </div>\n                    </a>\n                </li>\n                <li class="list-group-item">\n                    <a href="#setting/about">\n                        <div>\n                            <i class="fas fa-question-circle"></i>\n                        </div>\n                        <div>About</div>\n                        <div>\n                            <i class="fas fa-greater-than"></i>\n                        </div>\n                    </a>\n                </li>\n                </ul>\n            </div>\n            <div>\n                <div id="logout_btn" class="btn btn-secondary">\n                    <div><i class="fas fa-sign-out-alt"></i></div>\n                    <div>Logout</div>\n                </div>\n            </div>\n        </div>\n    ';!function(e){const n=document.querySelector("footer"),t=document.querySelector(".container");e.onclick=function(e){e.stopPropagation(),sessionStorage.clear(),localStorage.clear(),n.innerHTML="",t.style.justifyContent="center",window.location.hash=""}}(document.querySelector("#logout_btn"))}const W={otp:"",ref:"",pending:60,timeStamp:0,countdownTimer:null,redirectCountdownTimer:null,step:1};function z(){const e=document.querySelector("header");e.style.display="block",e.innerHTML='\n    <div id="header">reset password</div>\n    ';document.querySelector("#setting").innerHTML='\n        <div>\n            <div class="progress-container">\n                <div class="progress" id="progress"></div>\n                <div class="circle active">\n                    1\n                </div>\n                <div class="circle">\n                    2\n                </div>\n                <div class="circle">\n                    3\n                </div>\n                <div class="circle">\n                    4\n                </div>\n            </div>\n            <h1>Request OTP</h1>\n        </div>\n        <div id="phone_otp_input_login">\n            <button class="btn btn-warning">Request OTP <span></span></button>\n        </div>\n        <div>\n            <a href="#setting" class="btn btn-primary">Back To Setting</a>\n        </div>\n        ',function(){Z(W.step);const e=document.querySelector("#phone_otp_input_login"),n=e.querySelector("button");if(e&&n){n.onclick=async function(n){n.stopPropagation(),e.innerHTML=ne();const t=await c(),i={method:"post",mod:"cors",headers:{"Content-Type":"application/json","User-Token":""+d(),"Client-Token":t["Client-Token"],"Time-Stamp":t["Time-Stamp"],"Time-Signature":t["Time-Signature"]}},a=await fetch(o.loginRequestOTPEndpoint,i).then(e=>e.json()).then(e=>e).catch(e=>e);200===a.resCode?(W.ref=a.otpRef,W.timeStamp=(new Date).getTime(),e.innerHTML=te(),W.step+=1,Z(W.step),K(),function e(){const n=document.querySelector("#phone_otp_input_login"),t=document.querySelector(".digit-group").querySelectorAll("input");t.length&&(t[0].focus(),t.forEach(t=>{t.onchange=async function(t){const i=this.parentNode,a=t.target.value;if(document.querySelector("#invalid_otp_login").innerText="",a){const e=i.querySelector("input#"+this.dataset.next);e&&e.focus()}else if(a){if(W.otp="",formTag.querySelectorAll("input").forEach(e=>{W.otp+=e.value}),4===W.otp.length){n.innerHTML=ne();const t=await c(),i={method:"post",mod:"cors",headers:{"Content-Type":"application/json","User-Token":""+d(),"Client-Token":t["Client-Token"],"Time-Stamp":t["Time-Stamp"],"Time-Signature":t["Time-Signature"]},body:JSON.stringify({otp:W.otp,ref:W.ref})};if(200===(await fetch(o.loginVerifyOTPEndpoint,i).then(e=>e.json()).then(e=>e).catch(e=>e)).resCode)W.step+=1,Z(W.step),ee();else{n.innerHTML=te(W.pending);document.querySelector("#invalid_otp_login").innerText="Invalid OTP Code!",e(),K()}}}else{const e=i.querySelector("input#"+this.dataset.previous);e&&e.focus()}},t.onkeyup=async function(t){const i=this.parentNode,a=i.parentNode;if(document.querySelector("#invalid_otp_login").innerText="",8===t.keyCode||37===t.keyCode){const e=i.querySelector("input#"+this.dataset.previous);e&&e.focus()}else if(t.keyCode>=48&&t.keyCode<=57||t.keyCode>=65&&t.keyCode<=90||t.keyCode>=96&&t.keyCode<=105||39===t.keyCode){const t=i.querySelector("input#"+this.dataset.next);if(t)t.focus();else if(W.otp="",a.querySelectorAll("input").forEach(e=>{W.otp+=e.value}),4===W.otp.length){n.innerHTML=ne();const t=await c(),i={method:"post",mod:"cors",headers:{"Content-Type":"application/json","User-Token":""+d(),"Client-Token":t["Client-Token"],"Time-Stamp":t["Time-Stamp"],"Time-Signature":t["Time-Signature"]},body:JSON.stringify({otp:W.otp,ref:W.ref})};if(200===(await fetch(o.loginVerifyOTPEndpoint,i).then(e=>e.json()).then(e=>e).catch(e=>e)).resCode)W.step+=1,Z(W.step),ee();else{n.innerHTML=te(W.pending);document.querySelector("#invalid_otp_login").innerText="Invalid OTP Code!",e(),K()}}}}}))}()):(console.log(a.message),alert(a.message),window.location.hash="setting")}}}()}function Z(e=1){let n="";switch(e){case 1:n="request otp";break;case 2:n="verify otp";break;case 3:n="set new password";break;case 4:n="Success!";break;default:n="request otp"}const t=document.querySelector("#progress"),i=document.querySelectorAll(".circle");document.querySelector("#setting h1").innerText=n;let o=e;!function(){i.forEach((e,n)=>{n<o?e.classList.add("active"):e.classList.remove("active")});const e=document.querySelectorAll(".active");t.style.width=(e.length-1)/(i.length-1)*100+"%"}()}function K(e=60){W.countdownTimer&&clearTimeout(W.countdownTimer);const n=document.querySelector("#countdown");if(n){const e=(new Date).getTime();let t=W.pending,i=Math.floor((e-W.timeStamp)/1e3);if(i>=60?t=0:i<60&&60!==t&&(t=60-i),t>0)W.pending=t-1,n.innerText=W.pending,W.countdownTimer=setTimeout((function(){K(W.pending)}),1e3);else{const e=document.querySelector("#insert_otp_login button");e.removeAttribute("disabled"),n.parentNode.innerHTML="",e.onclick=function(n){n.preventDefault(),W.pending=60,e.setAttribute("disabled",!0),document.querySelector("#insert_otp_login button span").innerHTML=`(<span id="countdown">${W.pending}</span> sec)`,K(W.pending)}}}}function ee(){const e=document.querySelector("#phone_otp_input_login");e.innerHTML='\n        <form action="" autocomplete="off" id="reset_password_form_login">\n            <div class="mb-3">\n                <label for="password" class="form-label">New Password</label>\n                <input type="password" class="form-control" id="password_login" required>\n                <div class="invalid-feedback">Your password do not match</div>\n            </div>\n            <div class="mb-3">\n                <label for="password_repeat" class="form-label">Confirm password</label>\n                <input type="password" class="form-control" id="password_repeat_login" required>\n                <div class="invalid-feedback">Your password do not match</div>\n            </div>\n            <div style="display:flex; justify-content: center; align-items: center;">\n                <button type="submit" class="btn btn-warning">Reset Password</button>\n            </div>\n        </form>\n    ';const n=document.querySelector("#reset_password_form_login"),t=n.querySelector("button"),i=[...n.querySelectorAll("input")];i[0].focus(),i.forEach(e=>{e.oninput=function(){i.forEach(e=>{e.classList.remove("is-invalid")})}}),t.onclick=async function(n){n.preventDefault();const t=i.map(e=>e.value?e.value:null);if(t[0]===t[1]&&t[0]){const n=await c(),i={method:"post",mod:"cors",headers:{"Content-Type":"application/json","User-Token":""+d(),"Client-Token":n["Client-Token"],"Time-Stamp":n["Time-Stamp"],"Time-Signature":n["Time-Signature"]},body:JSON.stringify({otp:W.otp,ref:W.ref,password:t[0],confirmPassword:t[1]})},a=await fetch(o.loginVerifyOTPEndpoint,i).then(e=>e.json()).then(e=>e).catch(e=>e);if(200===a.resCode){W.step+=1,Z(W.step),console.log(a.message);let n=3;e.innerHTML=function(e="10"){return`\n        <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">\n            <img style="display:block; width: 50%; border-radius: 10px;" src="https://i.pinimg.com/originals/e8/06/52/e80652af2c77e3a73858e16b2ffe5f9a.gif">\n            <div>\n                <h2 style="text-align: center;">Success!</h2>\n            </div>\n            <div>\n                <p style="text-align: center;">Page redirect in <span id="redirect_countdown">${e}</span> seconds...</p>\n            </div>\n        </div>\n    `}(n),function e(n=10){const t=document.querySelector("#redirect_countdown");n>0?W.redirectCountdownTimer=setTimeout((function(){t.innerText=n-1,e(n-1)}),1e3):W.redirectCountdownTimer&&clearTimeout(W.redirectCountdownTimer)}(n),setTimeout((function(){W.step=1,window.location.hash="setting"}),1e3*n)}else console.log(a.message),alert(a.message)}else i.forEach(e=>{e.classList.add("is-invalid")})}}function ne(){return'\n        <div id="otp_loader_login">\n            <div class="spinner-border text-warning" style="width:3rem; height:3rem;" role="status">\n                <span class="visually-hidden">Loading...</span>\n            </div>\n            <h4>Loading...</h4>\n        </div>\n    '}function te(e=60){return`\n    <form class="digit-group" data-group-name="digits" autocomplete="off" id="insert_otp_login">\n        <div>\n            <h3>Enter OTP Code</h3>\n        </div>\n        <div>\n            <input autocomplete=off type="text" inputmode="numeric" id="digit-1" name="digit-1" data-next="digit-2" maxlength="1" />\n            <input autocomplete=off type="text" inputmode="numeric" id="digit-2" name="digit-2" data-next="digit-3" data-previous="digit-1"\n                maxlength="1" />\n            <input autocomplete=off type="text" inputmode="numeric" id="digit-3" name="digit-3" data-next="digit-4" data-previous="digit-2"\n                maxlength="1" />\n            <input autocomplete=off type="text" inputmode="numeric" id="digit-4" name="digit-4" data-previous="digit-3" maxlength="1" />\n        </div>\n        <div id="invalid_otp_login"></div>\n        <div>\n            <button class="btn btn-warning" type="submit" disabled>Request OTP <span>(<span id="countdown">${e}</span> sec)</span></button>\n        </div>\n    </form>\n    `}const ie={redirectCountdownTimer:null,id:"",trackingId:""};async function oe(e){e.preventDefault();const n=document.querySelector("#register_qr"),t=document.querySelector("#preprint_id_register"),i=document.querySelector("#tracking_id_register");ie.id=t.value.trim().toLowerCase();const a=ie.id;ie.trackingId=i.value.trim().toLowerCase();const r=ie.trackingId;if(n.innerHTML='\n            <div id="loader">\n                <div class="spinner-border text-warning" style="width:3rem; height:3rem;" role="status">\n                    <span class="visually-hidden">Loading...</span>\n                </div>\n                <h4>Loading...</h4>\n            </div>\n        ',/^p{2}\d{13}$/g.test(a)&&/^ex\d{13}$/g.test(r)){const e=await async function(e="",n=""){const t=localStorage.getItem("token"),i=await c(),a=await v(e);if(200===a.resCode&&!a.registered){const a=await fetch(o.registerPreprintIdEndpoint,{method:"post",mod:"cors",responseType:"json",headers:{"Content-Type":"application/json","User-Token":""+t,"Client-Token":i["Client-Token"],"Time-Stamp":i["Time-Stamp"],"Time-Signature":i["Time-Signature"]},body:JSON.stringify({qr:e,trackingID:n})}).then(e=>e.json()).then(e=>e).catch(e=>e);return console.log(a),a}return null}(ie.id,ie.trackingId);if(console.log(e),200===e.resCode){const e=3;n.innerHTML=function(e="10"){return`\n            <div style="display: flex; flex-direction: column; justify-content: center; align-items: center;">\n                <img style="display:block; width: 50%; border-radius: 10px;" src="https://i.pinimg.com/originals/e8/06/52/e80652af2c77e3a73858e16b2ffe5f9a.gif">\n                <div>\n                    <h2 style="text-align: center;">Success!</h2>\n                </div>\n                <div>\n                    <p style="text-align: center;">Page redirect in <span id="redirect_countdown">${e}</span> seconds...</p>\n                </div>\n            </div>\n        `}(e),function e(n=10){const t=document.querySelector("#redirect_countdown");n>0?ie.redirectCountdownTimer=setTimeout((function(){t.innerText=n-1,e(n-1)}),1e3):ie.redirectCountdownTimer&&clearTimeout(ie.redirectCountdownTimer)}(e),setTimeout((function(){const e=ie.trackingId;ie.redirectCountdownTimer=null,ie.id="",ie.trackingId="",window.location.hash="search/trackingid?id="+e}),1e3*e)}else console.log(e.message),alert(e.message),ae()}else ae()}function ae(){document.querySelector("#register_qr").innerHTML='\n            <div>\n                <form action="" autocomplete="off">\n                    <div class="mb-3">\n                        <label for="preprint_id_register" class="form-label">Prerint QR ID</label>\n                        <input type="text" class="form-control" id="preprint_id_register" autocomplete="off"\n                            placeholder="#PP0123456789012">\n                        <div class="invalid-feedback">Preprint ID starts with "PP"</div>\n                    </div>\n                    <div class="mb-3">\n                        <label for="tracking_id_register" class="form-label">Parcel Tracking ID</label>\n                        <input type="text" class="form-control" id="tracking_id_register"\n                            placeholder="#EX0123456789012">\n                        <div class="invalid-feedback">Parcel Tracking ID starts with "EX"</div>\n                    </div>\n                    <button type="submit" class="btn btn-warning">Register Parcel ID</button>\n                </form>\n            </div>\n            ';const e=document.querySelector("#preprint_id_register"),n=document.querySelector("#tracking_id_register");e.classList.add("is-invalid"),n.classList.add("is-invalid"),e.addEventListener("input",re),n.addEventListener("input",re);document.querySelector("#register_qr form").onsubmit=oe}function re(){this.id.includes("tracking_id")?ie.id=this.value:this.id.includes("preprint_id")&&(ie.trackingId=this.value);[...document.querySelectorAll("input")].forEach(e=>{e.classList.remove("is-invalid")})}window.onload=async function(){const e=localStorage.getItem("token")||sessionStorage.getItem("token");if(e){await l()?(window.location.hash="search/phone",document.querySelector("header").style.display="block",T("search"),V()):p()}else p();window.onhashchange=async function(){const e=window.location.hash.toLowerCase();console.log("path changes! "+e);const n=await l();if(function(){if(y.scanning){y.video&&y.video.srcObject.getTracks().forEach(e=>{e.stop()}),y.stream&&y.stream.getTracks().forEach(e=>{e.stop()}),y.scanning=!1,y.video=null,y.stream=null;document.querySelector("#qr-canvas").hidden=!0}}(),document.querySelector("header").style.display="none",W.otp="",W.ref="",W.pending=60,W.timeStamp=0,W.countdownTimer=null,W.redirectCountdownTimer=null,W.step=1,n)e.includes("#dashboard")?window.location.hash="search/phone":e.includes("#scanner")?(T("scanner"),b()):e.includes("#search")?(T("search"),V()):e.includes("#tasks")?T("tasks"):e.includes("#setting")?e.includes("userprofile")?function(){const e=document.querySelector("header");e.style.display="block",e.innerHTML='\n        <div id="header">user profile</div>\n    ',document.querySelector("#setting").innerHTML='\n        <div>\n        \n        </div>\n        <div>\n            \n        </div>\n        <div>\n            <a href="#setting" class="btn btn-primary">Back To Setting</a>\n        </div>\n    '}():e.includes("resetpassword")?z():e.includes("about")?function(){const e=document.querySelector("header");e.style.display="block",e.innerHTML='\n        <div id="header">user profile</div>\n    ',document.querySelector("#setting").innerHTML='\n        <div>\n        \n        </div>\n        <div>\n            \n        </div>\n        <div>\n            <a href="#setting" class="btn btn-primary">Back To Setting</a>\n        </div>\n    '}():(T("setting"),G()):e.includes("#registerqr")?function(e=null,n=null){const t=document.querySelector("header");t.style.display="block",t.innerHTML='\n        <div id="header">Register ID</div>\n    ',document.querySelector(".container").innerHTML='\n    <div id="register_qr">\n        <div>\n            <form action="" autocomplete="off">\n                <div class="mb-3">\n                    <label for="preprint_id_register" class="form-label">Prerint QR ID</label>\n                    <input type="text" class="form-control" id="preprint_id_register" autocomplete="off"\n                        placeholder="#PP0123456789012">\n                    <div class="invalid-feedback">Preprint ID starts with "PP"</div>\n                </div>\n                <div class="mb-3">\n                    <label for="tracking_id_register" class="form-label">Parcel Tracking ID</label>\n                    <input type="text" class="form-control" id="tracking_id_register"\n                        placeholder="#EX0123456789012">\n                    <div class="invalid-feedback">Parcel Tracking ID starts with "EX"</div>\n                </div>\n                <button type="submit" class="btn btn-warning">Register Parcel ID</button>\n            </form>\n        </div>\n    </div>\n    ',ie.id=m("id")||e,ie.trackingId=m("trackingId")||n;const i=document.querySelector("#preprint_id_register"),o=document.querySelector("#tracking_id_register");i.addEventListener("input",re),o.addEventListener("input",re),ie.id&&(i.value=ie.id),ie.trackingId&&(o.value=ie.trackingId),document.querySelector("#register_qr").querySelector("form").onsubmit=oe}():window.location.hash="";else switch(window.location.hash){case"#forgetpassword":w();break;default:p()}}}}]);